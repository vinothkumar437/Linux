<h3>DNS Setup on CentOS 7 / RHEL 7</h3>

<ol>
<li>Install the bind package</li>

<pre>
yum install bind* -y
</pre>

<li>Edit the named.conf file</li>

<pre>
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//
// See the BIND Administrator's Reference Manual (ARM) for details about the
// configuration located in /usr/share/doc/bind-{version}/Bv9ARM.html

options {
        listen-on port 53 { 127.0.0.1; 192.168.1.219; };
        listen-on-v6 port 53 { none; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        recursing-file  "/var/named/data/named.recursing";
        secroots-file   "/var/named/data/named.secroots";
        allow-query     { localhost; };

        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;

        dnssec-enable yes;
        dnssec-validation yes;

        /* Path to ISC DLV key */
        bindkeys-file "/etc/named.root.key";

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";


zone "example.com" {
        type master;
        file "/var/named/example.com.zone";
        allow-query { any; };
        allow-transfer { none; };
        allow-update { none; };
};

zone "1.168.192.in-addr.arpa" {
        type master;
        file "/var/named/1.168.192.in-addr.arpa.zone";
        allow-query { any; };
        allow-transfer { none; };
        allow-update { none; };
};
</pre>

<li>Edit the /var/named/example.com.zone forward zone file</li>
<pre>
$TTL 86400
@   IN  SOA     k8sdns.example.com. root.example.com. (
        2011071001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          k8sdns.example.com.
@       IN  A           192.168.1.219
@       IN  A           192.168.1.220
@       IN  A           192.168.1.221
@       IN  A           192.168.1.222
@       IN  A           192.168.1.223
k8sdns              IN  A   192.168.1.219
k8shaproxy          IN  A   192.168.1.220
</pre>

<li>Edit the /var/named/1.168.192.in-addr.arpa.zone reverse zone file</li>
<pre>
$TTL 86400
@   IN  SOA     k8sdns.example.com. root.example.com. (
        2011071001  ;Serial
        3600        ;Refresh
        1800        ;Retry
        604800      ;Expire
        86400       ;Minimum TTL
)
@       IN  NS          k8sdns.example.com.
@       IN  PTR         example.com.
k8sdns            IN  A   192.168.1.219
k8shaproxy        IN  A   192.168.1.220
219     IN  PTR         k8sdns.example.com.
220     IN  PTR         k8shaproxy.example.com.
</pre>
<li> Enable the named service</li>
<pre>
systemctl enable named.service
</pre>
<li> Start the named service</li>
<pre>
systemctl start named.service
</pre>
<li>Add the Nameserver entry on the /etc/resolv.conf file</li>
<pre>
# Generated by NetworkManager
search example.com
nameserver 192.168.1.219
nameserver 192.168.1.1
</pre>
<li>Verify the resolution</li>
<pre>
[root@localhost ~]# nslookup 192.168.1.220
220.1.168.192.in-addr.arpa      name = k8shaproxy.example.com.
</pre>
<pre>
[root@localhost ~]# nslookup k8shaproxy.example.com
Server:         192.168.1.219
Address:        192.168.1.219#53
<br/>
Name:   k8shaproxy.example.com
Address: 192.168.1.220
[root@localhost ~]#
</pre>

<pre>
C:\Users\Vinothkumar Palani>nslookup k8shaproxy.example.com
Server:  k8sdns.example.com
Address:  192.168.1.219

Name:    k8shaproxy.example.com
Address:  192.168.1.220

C:\Users\Vinothkumar Palani>
</pre>

</ol>
